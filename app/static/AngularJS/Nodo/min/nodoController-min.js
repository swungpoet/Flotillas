registrationModule.controller("nodoController",function(o,e,t,a,r,n,c){o.isLoading=!1,o.idProceso=1,o.perfil=1,o.idRol=20,o.idFase=1;var i=function(o,e,t,r){$("#btnEnviar").button("reset"),a.error("Ocurrio un problema")};o.init=function(){o.empleado=t.get("employeeLogged"),o.unidad=t.get("currentVIN"),n.getHeader(o.unidad.vin).success(s).error(i),r.getRolPermiso(o.empleado.idRol,t.get("vin")).success(u).error(i),$("#placa").hide()};var s=function(e,a,n,c){o.unidadHeader=e,o.valVin=o.unidadHeader.vin,t.set("vin",o.valVin),o.currentPage=o.unidadHeader.faseActual,r.getFasePermiso(o.empleado.idRol).success(d).error(i)},u=function(e,t,a,r){o.rolPermiso=e};o.VerOrdenPadre=function(o){location.href="/?id="+o.folioPadre+"&employee=1"},o.VerOrdenHijo=function(o){location.href="/?id="+o.folioHijo+"&employee=1"};var d=function(e,t,a,r){o.listaNodos=e,o.numElements=e.length,setTimeout(function(){$("ul#standard").roundabout({btnNext:".next",btnNextCallback:function(){p(".next")},btnPrev:".prev",btnPrevCallback:function(){p(".prev")},clickToFocusCallback:function(){p(".next")}}),f(o.currentPage)},1),n.getUnidad(o.unidadHeader.vin).success(l).error(i)},l=function(e,t,r,n){o.unidad=e,a.success("Datos de la unidad cargados.")},p=function(e){o.currentPage=$("ul#standard").roundabout("getChildInFocus")+1,0!=o.listaNodos[o.currentPage-1].enabled?f(o.currentPage):(a.warning("El nodo "+o.currentPage+" no está disponible para su perfil."),$(e).click())};o.setPage=function(e){o.currentPage=e.idFase,f(o.currentPage)};var f=function(e){$("ul#standard").roundabout("animateToChild",e-1),o.currentNode=o.listaNodos[e-1],b(),h()},b=function(){angular.forEach(o.listaNodos,function(e,t){t==o.currentPage-1?e.active=1:e.active=0}),v()},g=function(e,t,a,r){o.isLoading=!1,o.listaAlertas=e,v()},m=function(e,t,a,n){o.listaDocumentos=e,r.getDocFasePermiso(o.idRol,o.idFase).success(g).error(i)},h=function(){o.isLoading=!0,v(),r.getDocFasePermiso(o.idRol,o.idFase).success(m).error(i)},v=function(){"$apply"!=o.$root.$$phase&&"$digest"!=o.$root.$$phase&&o.$apply()};o.Cargar=function(){$("#frameUpload").attr("src","/uploader"),$("#modalUpload").modal("show"),e.currentUpload=doc},o.mostrarAccesorio=function(){$("#viewAccesorio").modal("show")},o.ocultarAccesorio=function(){$("#viewAccesorio").modal("hide")},$('[data-toggle="popover"]').popover(),$("[name='cbxGatoUni']").bootstrapSwitch(),$("[name='cbxLlaveTuerca']").bootstrapSwitch(),$("[name='cbxManeral']").bootstrapSwitch(),$("[name='cbxRefaccion']").bootstrapSwitch(),$("[name='cbxTapAlfombra']").bootstrapSwitch(),$("[name='cbxTapPlastico']").bootstrapSwitch(),$("[name='cbxTriSeguridad']").bootstrapSwitch(),$("[name='cbxBirlo']").bootstrapSwitch(),$("[name='cbxCable']").bootstrapSwitch(),$("[name='cbxExtintor']").bootstrapSwitch(),$("[name='cbxOtro']").bootstrapSwitch(),$("#txtOtroAcc").hide($("#cbxOtroAcc").bootstrapSwitch("state")),$("#cbxOtroAcc").on("switchChange.bootstrapSwitch",function(o,e){1==e?$("#txtOtroAcc").show(1e3,function(){$("#cbxOtroAcc").bootstrapSwitch("state")}):$("#txtOtroAcc").hide(1e3,function(){$("#cbxOtroAcc").bootstrapSwitch("state")})}),o.FinishUpload=function(o){a.success("Imagen "+o+" guardada");var r=e.currentUpload;c.saveFile(t.get("vin"),40,o).success(P).error(i)},o.Guardar=function(e,a){null!=e&&""!=a&&(""!=e?n.insertDocumento(t.get("vin"),e,a,o.empleado.idUsuario).success(x).error(i):n.updateDocumento(t.get("vin"),e,a,o.empleado.idUsuario).success(x).error(i))};var w=function(e,t,r,n){o.existeDocumento=e,a.success("Datos de unidad propiedad cargados.")},x=function(o,e,t,r){a.success("Datos de la unidad guardados.")},P=function(e,t,r,n){o.rutaNueva=e;var c=str.substring(str.length-3,str.length);(c="png")?$("#fotoFrente").attr("src",e):$("#placa").show(),a.success("Imágen Guardada.")};o.Regresar=function(o){location.href="/busqueda"};var S=function(e,t,r,n){o.rutaNueva=e,a.success("Archivo Guardado.")};o.verDocumento=function(){},o.verFactura=function(){window.open("http://192.168.20.9/Documentos/factura.pdf")}});